# Programs to use
TOUCH      = @touch
ECHO       = @echo
ECHO       = echo    # Uncomment this line to see the commands run.

# Some fancy echoing
CC           := $(ECHO) " [COMPILE] $<"; g++ # should really be compiled with gcc
LD           := $(ECHO) " [LINK   ] $<"; $(LD)
MAKEDEPEND   := $(ECHO) " [DEPEND ]"; makedepend

# Defines
DEFINES  := LITTLE_ENDIAN
CFLAGS   += $(patsubst %,-D%,$(DEFINES))
CPPFLAGS += $(patsubst %,-D%,$(DEFINES))

# Flags
CFLAGS += --std=c99             # We code Standard C
CFLAGS += -Wall                 # Enable many warnings
CFLAGS += -Wextra               # Enable even more warnings
#CFLAGS += -Werror               # Error out on warnings
CFLAGS += -Wno-unused-parameter # Do not warn about unused function parameters

LDFLAGS += --enable-auto-import -L/usr/lib -L. -largtable2

SOURCE_DIRS  := . thirdparty
VPATH        := $(SOURCE_DIRS)
INCLUDE_DIRS := $(VPATH)
INCLUDE_DIRS += ../../fpga/leon3/software ../../fpga/leon3/grlib-W2000A/software/leon3 /usr/include
CFLAGS       += $(patsubst %,-I%,$(subst :, ,$(INCLUDE_DIRS)))
CPPFLAGS     += $(patsubst %,-I%,$(subst :, ,$(INCLUDE_DIRS)))

SOURCES      := $(foreach DIR, $(subst :, ,$(VPATH)), $(wildcard $(DIR)/*.c))
SOURCES      += $(foreach DIR, $(subst :, ,$(VPATH)), $(wildcard $(DIR)/*.cpp))

SOURCES      += ../../fpga/leon3/software/DSO_Remote.c
SOURCES      += ../../fpga/leon3/software/DSO_SignalCapture.c
SOURCES      += ../../fpga/leon3/software/DSO_Misc.c

HEADERS      := $(foreach DIR, $(subst :, ,$(VPATH)), $(wildcard $(DIR)/*.c))
OBJS         := $(SOURCES:.c=.o)
OBJS         := $(OBJS:.cpp=.o)

DEPENDFILE   := depend
TARGET       := WaveRecorder

# Files to be cleaned
CLEAN := $(OBJS) $(DEPENDFILE) $(DEPENDFILE:=.bak) $(TARGET)

.PHONY: all
all: $(TARGET)

$(TARGET): $(OBJS)

.PHONY: clean
clean:
	$(ECHO) " [CLEAN  ]"
	@$(RM) $(CLEAN)

# Dependencies

# We usually want a full remake when the Makefile changes
$(OBJS): Makefile

# Automatic dependency rule generation by makedepend
MAKEDEPEND_DELIMITER = "\# Do not edit this file, run make depend to update!"
$(DEPENDFILE): $(SOURCES) $(HEADERS)
	$(TOUCH) $@
	$(MAKEDEPEND) -Y -m -s $(MAKEDEPEND_DELIMITER) -f $@ -- $(CFLAGS) $(LDFLAGS) -- $(SOURCES) >/dev/null 2>&1

include $(DEPENDFILE)
